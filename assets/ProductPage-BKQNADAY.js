import{r as N,j as s,S as q,P as w,k as P,L as y,h as k,a as A}from"./react-vendor-B8p8u1OW.js";import{d as D,u as B,f as L,e as S,G as R,S as F,g as M,W as E,h as O}from"./index-QZQBwWY5.js";import{s as I,q as U,f as X,c as G,p as z}from"./ps5_pro-Er-flBfv.js";import{D as W,a as H,S as J}from"./switch_pro2-BO0UciiA.js";import{a as T,b as K,g as Q}from"./cart-1N_2ByxL.js";const Y=({mainImage:n=[],productTitle:l="",productMeta:e="",originalPrice:c,salePrice:m,productStatus:p,st:r={},onAddToCart:g=()=>{},onBuyNow:f=()=>{}})=>{var u;const h=(n||[]).slice(0,4).map((b,j)=>({src:b,alt:`商品大圖 ${j+1}`})),[i,a]=N.useState(0),[_,o]=N.useState(!1);let v=null,t=r.status||"商品狀態";if(typeof p=="string"){const b=(u=D)==null?void 0:u[p];v=(b==null?void 0:b.image)||null,t=(b==null?void 0:b.label)||t}else p&&typeof p=="object"&&(v=p.icon||null,t=p.label||t);const d=s.jsx("div",{className:"product-price",children:m!=null?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"original-price",children:["NTD$",Number(c).toLocaleString()]}),s.jsxs("span",{className:"sale-price",children:["NTD$",Number(m).toLocaleString()]})]}):s.jsxs("span",{className:"sale-price",children:["NTD$",Number(c).toLocaleString()]})});return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"product-page product-page-pc",children:[s.jsxs("div",{className:"product-gallery",children:[s.jsx("div",{className:"thumbnails",children:h.map((b,j)=>s.jsx("div",{className:`thumb ${j===i?"is-active":""}`,onMouseEnter:()=>a(j),children:s.jsx("img",{src:b.src,alt:`縮圖 ${j+1}`})},j))}),s.jsx("div",{className:"main-image",children:h[i]&&s.jsx("img",{src:h[i].src,alt:h[i].alt})})]}),s.jsxs("div",{className:"product-detail",children:[s.jsxs("div",{className:"product-main",children:[s.jsx("h1",{className:"product-title",children:l}),s.jsxs("div",{className:"product-mainInfo",children:[s.jsxs("p",{className:"product-meta",children:["上架日期：",(e||"").replaceAll("-",".")]}),d]})]}),s.jsxs("div",{className:"product-actions",children:[s.jsx("button",{type:"button",className:`btn-fav ${_?"active":""}`,onClick:()=>o(!_),"aria-label":"加入收藏（Add to favorites 加入收藏）",children:s.jsx("span",{className:"heart"})}),s.jsx("button",{type:"button",className:"btn-cart btn",onClick:g,"aria-label":"加入購物車（Add to Cart 加入購物車）",children:"加入購物車"}),s.jsx("button",{type:"button",className:"btn-buy btn",onClick:f,"aria-label":"直接購買（Buy Now 直接購買）",children:"直接購買"})]}),v&&s.jsx("div",{className:"product-status",children:s.jsx("img",{src:v,alt:t})}),s.jsxs("div",{className:"product-description",children:[s.jsx("h2",{children:"商品說明"}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品狀態："}),r.status||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"其他備註："}),r.note||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品位置："}),r.location||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"運送服務："}),r.shipping||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"付款方式："}),r.payment||"-"]})]})]})]})]}),s.jsxs("div",{className:"product-page product-page-mobile",children:[s.jsx("div",{className:"carousel",children:s.jsx(q,{modules:[w],pagination:{type:"fraction"},style:{width:"100%",height:"100%"},children:h.map((b,j)=>s.jsx(P,{children:s.jsx("img",{src:b.src,alt:b.alt,style:{width:"100%",height:"100%",objectFit:"cover"}})},j))})}),s.jsxs("div",{className:"detail_mobile",children:[s.jsx("div",{className:"mobile_title",children:l}),s.jsxs("div",{className:"mobile_infor",children:[s.jsxs("div",{className:"mobile_price",children:[s.jsx("p",{className:"new_price",children:m!=null?`NTD$${Number(m).toLocaleString()}`:`NTD$${Number(c).toLocaleString()}`}),m!=null&&s.jsxs("p",{className:"old_price",children:["NTD$",Number(c).toLocaleString()]})]}),s.jsxs("div",{className:"mobile_date",children:["上架日期：",(e||"").replaceAll("-",".")]})]}),s.jsxs("div",{className:"mobile_description",children:[s.jsxs("div",{className:"md",children:[s.jsx("h2",{children:"商品說明"}),v&&s.jsx("img",{src:v,alt:t,className:"mobile_status"})]}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品狀態："}),r.status||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"其他備註："}),r.note||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品位置："}),r.location||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"運送服務："}),r.shipping||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"付款方式："}),r.payment||"-"]})]})]}),s.jsxs("div",{className:"mobile_actions",style:{display:"flex",gap:8,marginTop:12},children:[s.jsx("button",{type:"button",className:"btn-cart btn",onClick:g,"aria-label":"加入購物車（Add to Cart 加入購物車）",style:{flex:1},children:"加入購物車"}),s.jsx("button",{type:"button",className:"btn-buy btn",onClick:f,"aria-label":"直接購買（Buy Now 直接購買）",style:{flex:1},children:"直接購買"})]})]})]})]})},C={check:G,fastShip:X,quickReply:U},V=({productId:n,sellerAvatar:l,sellerName:e,sellerScore:c,sellerCount:m,sellerLocation:p,sellerTags:r=[],sellerDesc:g})=>{var _,o,v,t;const{openChat:f}=B(),h=l||L,[i,a]=N.useState(()=>sessionStorage.getItem(`follow-${e}`)==="true");return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"seller seller-pc",children:[s.jsxs("div",{className:"seller__profile",children:[s.jsx("img",{src:h,alt:"賣家頭像",className:"seller__avatar"}),s.jsx("p",{className:"seller__name",children:e})]}),s.jsxs("div",{className:"seller__rwd",children:[s.jsxs("div",{className:"seller__stats",children:[s.jsxs("div",{className:"seller__rating",children:[s.jsx("span",{className:"seller__score",children:(o=(_=c==null?void 0:c.toFixed)==null?void 0:_.call(c,1))!=null?o:c}),s.jsx("img",{src:I,alt:"評分星等"}),s.jsxs("span",{className:"seller__count",children:["(",m,"則評價)"]})]}),s.jsx("p",{className:"seller__location",children:p}),s.jsx("div",{className:"seller__tags",children:r.map(d=>{const u=C[d];return u?s.jsx("img",{src:u,alt:d},d):null})})]}),s.jsx("div",{className:"seller__desc",children:s.jsx("p",{children:g})})]}),s.jsxs("div",{className:"seller__actions",children:[s.jsx("button",{className:"btn",onClick:()=>a(d=>{const u=!d;return sessionStorage.setItem(`follow-${e}`,u),u&&S(e),u}),children:i?"追蹤中":"追蹤+"}),s.jsx("button",{className:"btn",onClick:()=>f(e,n),children:"聊聊"})]})]}),s.jsxs("div",{className:"seller seller-mobile",children:[s.jsx("img",{src:h,alt:"賣家頭像",className:"seller__avatar"}),s.jsxs("div",{className:"scenter",children:[s.jsx("p",{className:"seller__name",children:e}),s.jsxs("div",{className:"seller__rating",children:[s.jsx("span",{className:"seller__score",children:(t=(v=c==null?void 0:c.toFixed)==null?void 0:v.call(c,1))!=null?t:c}),s.jsx("img",{src:I,alt:"評分星等"}),s.jsxs("span",{className:"seller__count",children:["(",m,"則評價)"]})]}),s.jsx("div",{className:"seller__tags",children:r.map(d=>{const u=C[d];return u?s.jsx("img",{src:u,alt:d},d):null})})]}),s.jsxs("div",{className:"seller__actions",children:[s.jsx("button",{className:"btn",onClick:()=>a(d=>{const u=!d;return sessionStorage.setItem(`follow-${e}`,u),u&&S(e),u}),children:i?"追蹤中":"追蹤+"}),s.jsx("button",{className:"btn",onClick:()=>f(e,n),children:"聊聊"})]})]})]})},Z=({detailContent:n=""})=>s.jsxs("div",{className:"detail",children:[s.jsx("div",{className:"detail_title",children:"商品詳細說明"}),s.jsx("div",{className:"detail_content",children:n||"—"})]}),x=(n,l)=>Math.floor(Math.random()*(l-n+1))+n,ss=()=>{const n="23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz";return n[x(0,n.length-1)]},$=(n=5)=>Array.from({length:n},ss).join("");function es({length:n=5,width:l=120,height:e=40,onChange:c}){const m=N.useRef(null),[p,r]=N.useState($(n)),g=N.useCallback(h=>{const i=m.current;if(!i)return;const a=i.getContext("2d");a.clearRect(0,0,l,e),a.fillStyle="#f3f4f6",a.fillRect(0,0,l,e);for(let o=0;o<30;o++)a.fillStyle=`rgba(${x(0,255)}, ${x(0,255)}, ${x(0,255)}, 0.6)`,a.fillRect(x(0,l),x(0,e),1,1);for(let o=0;o<3;o++)a.strokeStyle=`rgba(${x(0,255)}, ${x(0,255)}, ${x(0,255)}, 0.7)`,a.lineWidth=x(1,2),a.beginPath(),a.moveTo(x(0,l/3),x(0,e)),a.bezierCurveTo(x(0,l),x(0,e),x(0,l),x(0,e),x(l/2,l),x(0,e)),a.stroke();const _=l/(h.length+1);for(let o=0;o<h.length;o++){const v=h[o],t=x(18,24);a.font=`${t}px ui-monospace, SFMono-Regular, Menlo, monospace`,a.fillStyle=`rgb(${x(30,120)}, ${x(30,120)}, ${x(30,120)})`;const d=_*(o+1),u=x(e*.6,e*.8),b=x(-25,25)*Math.PI/180;a.save(),a.translate(d,u),a.rotate(b),a.fillText(v,0,0),a.restore()}},[l,e]),f=N.useCallback(()=>{const h=$(n);r(h),c==null||c(h)},[n,c]);return N.useEffect(()=>{g(p)},[p,g]),N.useEffect(()=>{c==null||c(p)},[]),s.jsxs("div",{className:"captcha",children:[s.jsx("canvas",{ref:m,width:l,height:e,"aria-label":"驗證碼（captcha，驗證使用者是否為人類）圖片",role:"img"}),s.jsx("button",{type:"button",className:"captcha__refresh",onClick:f,"aria-label":"重整驗證碼",children:"↻"})]})}const as=({productId:n,initialQa:l=[]})=>{const[e,c]=N.useState(""),[m,p]=N.useState(""),[r,g]=N.useState(""),[f,h]=N.useState(""),i=N.useMemo(()=>`qa:${n||"default"}`,[n]),[a,_]=N.useState(()=>{try{const t=localStorage.getItem(i);return t?JSON.parse(t):l}catch(t){return l}});N.useEffect(()=>{try{localStorage.setItem(i,JSON.stringify(a))}catch(t){}},[a,i]);const o=()=>{const t=new Date,d=u=>String(u).padStart(2,"0");return`${t.getFullYear()}.${d(t.getMonth()+1)}.${d(t.getDate())} ${d(t.getHours())}:${d(t.getMinutes())}:${d(t.getSeconds())}`},v=t=>{if(t.preventDefault(),!f.trim()){g("請先輸入提問內容 ❌");return}if(m.trim().toLowerCase()!==e.trim().toLowerCase()){g("驗證失敗，請再試一次 ❌");return}const d={user:"@guest****",time:o(),content:f.trim()};_(u=>[d,...u]),h(""),p(""),g("驗證成功 ✅ 已送出提問")};return s.jsxs("div",{className:"qa",children:[a.length>0?a.map((t,d)=>s.jsxs("div",{className:"qa_item",children:[s.jsxs("div",{className:"qa_header",children:[s.jsxs("p",{className:"qa_number",children:["問題",a.length-d]}),s.jsx("p",{className:"qa_user",children:t.user}),s.jsxs("p",{className:"qa_time",children:["(",t.time,")"]})]}),s.jsx("div",{className:"qa_question",children:s.jsx("p",{children:t.content})}),t.answer&&s.jsxs("div",{className:"qa_answer",children:[s.jsxs("div",{className:"qa_ans",children:[s.jsx("span",{className:"qa_answer-label",children:"答覆："}),s.jsx("p",{className:"qa_answer-content",children:t.answer})]}),s.jsxs("p",{className:"qa_time",children:["(",t.answerTime,")"]})]})]},d)):s.jsx("p",{className:"qa_empty",children:"目前還沒有提問，成為第一個提問的人吧！"}),s.jsxs("form",{className:"qa_ask",onSubmit:v,children:[s.jsx("p",{className:"qa_title",children:"提出問題"}),s.jsx("span",{className:"qa_policy",children:"為保障會員交易安全，留言請勿填寫個人資料、外部連結或任何導私下交易之內容，否則您送出的內容可能無法正常顯示。"}),s.jsx("textarea",{name:"askbox",className:"qa_askbox",placeholder:"(250個中文字以內)",maxLength:250,value:f,onChange:t=>h(t.target.value),required:!0}),s.jsxs("div",{className:"allCaptcha",children:[s.jsxs("div",{className:"qa__field qa__captcha",children:[s.jsx(es,{length:5,onChange:c}),s.jsx("input",{type:"text",id:"captcha",name:"captcha",className:"qa__captcha-input",inputMode:"text",autoComplete:"off",placeholder:"請輸入上方驗證碼",value:m,onChange:t=>p(t.target.value),required:!0}),r&&s.jsx("small",{className:`qa_msg ${r.includes("成功")?"ok":"err"}`,children:r})]}),s.jsx("button",{className:"qa_btn btn",type:"submit",children:"送出"})]})]})]})},ts=({userImg:n,userName:l,upDate:e,commodityImage:c,commodityTitle:m,commodityPrice:p})=>{const[r,g]=N.useState(!1);return s.jsx("div",{className:"abc",children:s.jsx("div",{className:"o1",children:s.jsxs("div",{className:"o2",children:[s.jsxs("div",{className:"cain",children:[s.jsxs(y,{to:"/Reviewpage",className:"userInfo",children:[s.jsx("div",{children:s.jsx("img",{src:n,alt:"",className:"userImg"})}),s.jsxs("div",{children:[s.jsx("p",{className:"userName",children:l}),s.jsx("p",{className:"upDate",children:e})]})]}),s.jsxs("a",{href:"",className:"commodityInfo",children:[s.jsx("div",{className:"comImg",children:s.jsx("img",{src:c,alt:""})}),s.jsx("p",{className:"comTitle",children:m}),s.jsxs("p",{className:"comPrice",children:["NT$",p]})]})]}),s.jsx("div",{className:"comHeart",children:s.jsx("button",{className:`btn-fav ${r?"active":""}`,onClick:()=>g(!r),children:s.jsx("span",{className:"heart"})})})]})})})},ls=()=>{const n=[{id:1,userImg:R,userName:"paly**56",upDate:"3天前",commodityImage:W,commodityTitle:"咚奇剛蕉力全開+咚奇剛amiibo",commodityPrice:"800"},{id:2,userImg:F,userName:"Ds2CE**6",upDate:"3天前",commodityImage:H,commodityTitle:"死亡擱淺典藏版",commodityPrice:"1100"},{id:3,userImg:M,userName:"Ssp**5",upDate:"3天前",commodityImage:z,commodityTitle:"PS5 PRO主機 1TB 極致黑",commodityPrice:"9999"},{id:4,userImg:E,userName:"fun31**56",upDate:"3天前",commodityImage:J,commodityTitle:"Switch 2全新主機",commodityPrice:"5000"}];return s.jsx("div",{className:"containerPrCard",children:n.map(l=>s.jsx(ts,{userImg:l.userImg,userName:l.userName,upDate:l.upDate,commodityImage:l.commodityImage,commodityTitle:l.commodityTitle,commodityPrice:l.commodityPrice},l.id))})},cs=()=>s.jsxs("div",{className:"recommend",children:[s.jsx("p",{className:"recommend_title",children:"你可能有興趣的商品"}),s.jsx(ls,{}),s.jsx("div",{className:"recommend_btn",children:s.jsx("button",{className:"btn",children:"更多商品"})})]}),rs=({title:n="",img:l="",qty:e=1,count:c=0,visible:m=!1,onClick:p=()=>{},onClose:r=()=>{},duration:g=3e3})=>{const f=N.useRef(null);return N.useEffect(()=>{if(m)return clearTimeout(f.current),f.current=setTimeout(()=>r(),g),()=>clearTimeout(f.current)},[m,g,r]),s.jsx("div",{className:`cartToast ${m?"is-show":""}`,role:"status","aria-live":"polite","aria-atomic":"true",children:s.jsxs("button",{type:"button",className:"cartToast__card",onClick:p,children:[s.jsx("div",{className:"cartToast__media",children:l?s.jsx("img",{src:l,alt:""}):s.jsx("div",{className:"ph"})}),s.jsxs("div",{className:"cartToast__content",children:[s.jsx("p",{className:"cartToast__title",children:n}),s.jsxs("p",{className:"cartToast__desc",children:["已加入購物車 ×",e," ｜ 目前共 ",c," 件"]}),s.jsx("p",{className:"cartToast__cta",children:"前往購物車 →"})]}),s.jsx("span",{className:"cartToast__close","aria-label":"關閉（Close 關閉）",onClick:h=>{h.stopPropagation(),r()},children:"×"})]})})},ns={Switch:{label:"Switch",to:"/alltype/Switch/all#B_itemTitles"},PS:{label:"PS",to:"/alltype/PS/all#B_itemTitles"},Xbox:{label:"Xbox",to:"/alltype/Xbox/all#B_itemTitles"}},xs=()=>{var h;const{id:n}=k(),l=decodeURIComponent(n||""),e=O(l),c=A();N.useEffect(()=>{document.title=e!=null&&e.productTitle?`${e.productTitle} ｜ 遊玩人間市集`:"商品不存在 ｜ 遊玩人間市集"},[e==null?void 0:e.productTitle]);const[m,p]=N.useState({show:!1,title:"",img:"",qty:1,count:0});if(!e)return s.jsxs("div",{className:"product",children:[s.jsxs("nav",{className:"breadcrumb",children:[s.jsx(y,{to:"/",children:"首頁"}),s.jsx("span",{className:"angleBracket",children:"›"}),s.jsx("span",{className:"is-current",children:"找不到此商品"})]}),s.jsx("div",{className:"section",children:"很抱歉，這個商品不存在或已下架。"})]});let r;if(Array.isArray(e.breadcrumb)&&e.breadcrumb.length>0)r=e.breadcrumb;else{const i=b=>{const j=String(b||"").trim();return j==="PS系列"||j==="PlayStation"||j==="ps"||j==="Ps"?"PS":j==="XBOX"||j==="xbox"?"Xbox":j||"Switch"},a=b=>{const j=String(b||"").replace(/\u3000/g," ").trim();return["主機","機台"].includes(j)?"主機":["遊戲","軟體","遊戲片"].includes(j)?"遊戲":["配件","周邊","周邊商品"].includes(j)?"配件":j===""||j==="全部"?"全部":j},_=i(e.platform),o=a(e.category),t={主機:"console",遊戲:"game",配件:"accessory",全部:"all"}[o]||"all",d=(h=ns[_])!=null?h:{label:_||"Switch",to:`/alltype/${encodeURIComponent(_||"Switch")}/all#B_itemTitles`},u={label:o||"全部",to:`/alltype/${encodeURIComponent(_)}/${t}#B_item`};r=[d,u]}const g=(i=1)=>{var a,_;try{const o=Array.isArray(e.mainImage)?e.mainImage[0]:e.thumb||"";T({id:e.id,title:e.productTitle,price:(_=(a=e.salePrice)!=null?a:e.originalPrice)!=null?_:0,img:o,sellerName:e.sellerName},Number(i)||1);const v=K();p({show:!0,title:e.productTitle,img:o,qty:Number(i)||1,count:v})}catch(o){console.error("Add to cart failed（加入購物車失敗）:",o,{addItemType:typeof T,getCartType:typeof Q}),alert("加入購物車失敗，請稍後再試。")}},f=(i=1)=>{var a,_;try{const o=Array.isArray(e.mainImage)?e.mainImage[0]:e.thumb||"";T({id:e.id,title:e.productTitle,price:(_=(a=e.salePrice)!=null?a:e.originalPrice)!=null?_:0,img:o},Number(i)||1),c("/Shopping_cart")}catch(o){console.error("Buy now failed（立即購買失敗）:",o),alert("處理失敗，請稍後再試。")}};return s.jsxs(s.Fragment,{children:[s.jsx(rs,{title:m.title,img:m.img,qty:m.qty,count:m.count,visible:m.show,onClick:()=>c("/Shopping_cart"),onClose:()=>p(i=>({...i,show:!1})),duration:3e3}),s.jsxs("div",{className:"product",children:[s.jsxs("nav",{className:"breadcrumb","aria-label":"Breadcrumb（導覽路徑）",children:[s.jsx(y,{to:"/",children:"首頁"}),s.jsx("span",{className:"angleBracket",children:"›"}),r.map((i,a)=>s.jsxs("span",{className:"breadcrumb__item",children:[i.to?s.jsx(y,{to:i.to,children:i.label}):s.jsx("span",{children:i.label}),s.jsx("span",{className:"angleBracket",children:"›"})]},`${i.label}-${a}`)),s.jsx("span",{className:"is-current",children:e.productTitle})]}),s.jsx("section",{className:"product__info section",children:s.jsx(Y,{...e,onAddToCart:g,onBuyNow:f})}),s.jsxs("aside",{className:"product__seller section",children:[s.jsx("div",{className:"top_decorate"}),s.jsx(V,{sellerAvatar:e.sellerAvatar,sellerName:e.sellerName,sellerScore:e.sellerScore,sellerCount:e.sellerCount,sellerLocation:e.sellerLocation,sellerTags:e.sellerTags,sellerDesc:e.sellerDesc}),s.jsx("div",{className:"down_decorate"})]}),s.jsx("section",{className:"product__detail section",children:s.jsx(Z,{detailContent:e.detailContent})}),s.jsxs("section",{className:"product__qa section",children:[s.jsx("div",{className:"top_decorate2"}),s.jsx(as,{productId:e.id,initialQa:e.qa||[]}),s.jsx("div",{className:"down_decorate2"})]}),s.jsx("section",{className:"product__recommend section",children:s.jsx(cs,{items:e.recommendItems||[]})})]})]})};export{xs as default};
