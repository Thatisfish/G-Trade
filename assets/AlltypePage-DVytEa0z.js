import{h as O,a as M,u as D,j as a,e as X,r as c,H as $,S as G,i as H,N as A}from"./react-vendor-CEea2Jcx.js";import{A as F,P as V,N as Y}from"./swiper-N-f5SBSU.js";import{P as q,A as z}from"./index-CwnBu0uV.js";import{P as K}from"./Pagination-vTLnHNfk.js";import"./vendor-DLEfv8Se.js";const W=""+new URL("banner_pokemon-vfmWkoXl.avif",import.meta.url).href,Q=""+new URL("Alltype_banner02-D2iXLrGG.avif",import.meta.url).href,Z=""+new URL("Alltype_banner03-BwrycHns.avif",import.meta.url).href,J=""+new URL("Alltype_PS_banner01-Bc3WwUd5.webp",import.meta.url).href,ee=""+new URL("Alltype_PS_banner02-CxGMZ0Gl.avif",import.meta.url).href,te=""+new URL("Alltype_PS_banner03-B7H7cIoY.avif",import.meta.url).href,re=""+new URL("Alltype_Xbox_banner01-BHQoPPhq.avif",import.meta.url).href,ae=""+new URL("Alltype_Xbox_banner04-DuODmEVd.avif",import.meta.url).href,se={Switch:[W,Q,Z],PS:[J,ee,te],Xbox:[re,ae]},y={Switch:"Switch",PS:"PS系列",Xbox:"Xbox"},j=["全部","主機","遊戲","配件"],ne={全部:"all",主機:"console",遊戲:"game",配件:"accessory"},oe={all:"全部",console:"主機",game:"遊戲",accessory:"配件"},L=["Switch","PS","Xbox"],ce=["all","console","game","accessory"],le=r=>{var d,m,o,n;return(n=(o=(m=(d=r==null?void 0:r.id)!=null?d:r==null?void 0:r.slug)!=null?m:r==null?void 0:r.productId)!=null?o:r==null?void 0:r.pid)!=null?n:null},ie=r=>{var m,o,n,g,l,u,S,f,i;return{id:le(r),image:Array.isArray(r.mainImage)?r.mainImage[0]:r.mainImage,category:r.category,title:r.productTitle,seller:r.sellerName||"",priceNow:(g=(n=(o=(m=r.salePrice)!=null?m:r.originalPrice)==null?void 0:o.toString)==null?void 0:n.call(o))!=null?g:"",priceOld:r.salePrice!=null?(S=(u=(l=r.originalPrice)==null?void 0:l.toString)==null?void 0:u.call(l))!=null?S:"":void 0,size:"medium",meta:r.productMeta,priceNum:Number((f=r.salePrice)!=null?f:r.originalPrice)||0,sellerScore:Number((i=r.sellerScore)!=null?i:0)}};function fe(){const{platform:r,category:d}=O(),m=M(),o=D(),n=decodeURIComponent(r||"");if(!L.includes(n))return a.jsx(X,{to:"/alltype/Switch/all",replace:!0});c.useEffect(()=>{d||m(`/alltype/${n}/all`,{replace:!0,state:{noScroll:!0}})},[d,n,m]);const g=ce.includes(d||"")?d:"all",l=oe[g]||"全部",u=c.useMemo(()=>{const e=q.filter(s=>s.platform===n).map(ie),t=e.filter(s=>!s.id);return t.length&&console.warn("[AlltypePage] 有商品缺少 id：",t),e.filter(s=>!!s.id)},[n]),S=c.useMemo(()=>u.reduce((e,t)=>(e.全部++,j.includes(t.category)&&(e[t.category]=(e[t.category]||0)+1),e),{全部:0,主機:0,遊戲:0,配件:0}),[u]),f=c.useMemo(()=>l==="全部"?u:u.filter(e=>e.category===l),[u,l]),[i,p]=c.useState("default"),w=c.useMemo(()=>{const e=[...f];switch(i){case"price-asc":e.sort((t,s)=>t.priceNum-s.priceNum);break;case"price-desc":e.sort((t,s)=>s.priceNum-t.priceNum);break;case"date-new":e.sort((t,s)=>new Date(s.meta)-new Date(t.meta));break;case"date-old":e.sort((t,s)=>new Date(t.meta)-new Date(s.meta));break;case"score-desc":e.sort((t,s)=>s.sellerScore-t.sellerScore);break;case"score-asc":e.sort((t,s)=>t.sellerScore-s.sellerScore);break}return e},[f,i]),[b,x]=c.useState(1);c.useEffect(()=>{x(1)},[g,n]),c.useEffect(()=>{x(1)},[i]);const P=12,_=Math.ceil(w.length/P),C=c.useMemo(()=>{const e=(b-1)*P,t=e+P;return w.slice(e,t)},[w,b]),T=e=>{x(e)},k=e=>{const t=ne[e]||"all";m(`/alltype/${n}/${t}`,{state:{noScroll:!0}})},N=e=>({pathname:`/alltype/${e}/${g}`,state:{noScroll:!0}}),R=se[n]||[],h=L.filter(e=>e!==n),I=(()=>{var t;const e=((t=document.querySelector(".navbar, .site-header"))==null?void 0:t.offsetHeight)||0;return Math.max(80,e+12)})(),E=e=>{if(!e)return;const t=e.replace(/^#/,"");let s=0;const B=()=>{const v=document.getElementById(t);if(v){const U=v.getBoundingClientRect().top+window.scrollY-I;window.scrollTo({top:U,behavior:"smooth"});return}s<20&&(s+=1,setTimeout(B,60))};setTimeout(B,0)};return c.useEffect(()=>{o.hash&&E(o.hash)},[o.key,o.hash]),a.jsxs(a.Fragment,{children:[a.jsxs($,{children:[a.jsx("title",{children:`遊玩人間市集 ｜ ${y[n]} ｜ ${l}`}),a.jsx("meta",{name:"description",content:"歡迎來到遊玩人間市集，探索各式二手遊戲商品。"})]}),a.jsxs("div",{className:"B_content",children:[a.jsx("div",{className:"B_banner",children:a.jsx(G,{spaceBetween:30,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0,modules:[F,V,Y],className:"mySwiper",children:R.map((e,t)=>a.jsx(H,{children:a.jsx("img",{src:e,alt:"活動橫幅"})},t))})}),a.jsxs("div",{id:"B_itemTitles",className:"B_itemTitles",children:[h[0]&&a.jsx(A,{className:"B_itemTitle",to:N(h[0]),children:y[h[0]]}),a.jsx("p",{className:"B_name",children:y[n]}),h[1]&&a.jsx(A,{className:"B_itemTitle",to:N(h[1]),children:y[h[1]]})]}),a.jsx("div",{className:"B_category",role:"tablist","aria-label":"商品分類 (category 類別)",children:j.map(e=>{var s;const t=l===e;return a.jsxs("button",{className:`B_Categories ${t?"is-active":""}`,type:"button",role:"tab","aria-selected":t,onClick:()=>k(e),children:[e,"（",(s=S[e])!=null?s:0,"）"]},e)})}),a.jsxs("div",{className:"B_sortButtons","aria-label":"排序控制（sorting）",children:[a.jsx("button",{className:i==="price-asc"?"is-active":"",onClick:()=>p("price-asc"),children:"價格 ↑"}),a.jsx("button",{className:i==="price-desc"?"is-active":"",onClick:()=>p("price-desc"),children:"價格 ↓"}),a.jsx("button",{className:i==="date-new"?"is-active":"",onClick:()=>p("date-new"),children:"日期 新→舊"}),a.jsx("button",{className:i==="date-old"?"is-active":"",onClick:()=>p("date-old"),children:"日期 舊→新"})]}),a.jsx("div",{id:"B_item",className:"B_item",children:C.map(e=>a.jsx(z,{id:e.id,image:e.image,category:e.category,title:e.title,seller:e.seller,priceNow:e.priceNow,priceOld:e.priceOld,size:"medium",linkTo:`/product/${encodeURIComponent(e.id)}`,wrapperClass:"B_cardLink",ariaLabel:e.title},e.id))}),_>1&&a.jsx(K,{totalPages:_,onPageChange:T,currentPage:b})]})]})}export{fe as default};
