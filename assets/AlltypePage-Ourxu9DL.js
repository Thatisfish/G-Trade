import{h as O,a as M,u as D,j as s,e as X,r as l,H as $,S as G,i as H,N as j}from"./react-vendor-CEea2Jcx.js";import{A as F,P as V,N as Y}from"./swiper-N-f5SBSU.js";import{P as q,A as z}from"./index-DtZxnXMa.js";import{P as K}from"./Pagination-vTLnHNfk.js";import"./vendor-DLEfv8Se.js";const W=""+new URL("banner_pokemon-vfmWkoXl.avif",import.meta.url).href,Q=""+new URL("Alltype_banner02-D2iXLrGG.avif",import.meta.url).href,Z=""+new URL("Alltype_banner03-BwrycHns.avif",import.meta.url).href,J=""+new URL("Alltype_PS_banner01-Bc3WwUd5.webp",import.meta.url).href,ee=""+new URL("Alltype_PS_banner02-CxGMZ0Gl.avif",import.meta.url).href,te=""+new URL("Alltype_PS_banner03-B7H7cIoY.avif",import.meta.url).href,ae=""+new URL("Alltype_Xbox_banner01-BHQoPPhq.avif",import.meta.url).href,se=""+new URL("Alltype_Xbox_banner04-DuODmEVd.avif",import.meta.url).href,re={Switch:[W,Q,Z],PS:[J,ee,te],Xbox:[ae,se]},y={Switch:"Switch",PS:"PS系列",Xbox:"Xbox"},A=["全部","主機","遊戲","配件"],ne={全部:"all",主機:"console",遊戲:"game",配件:"accessory"},ce={all:"全部",console:"主機",game:"遊戲",accessory:"配件"},C=["Switch","PS","Xbox"],oe=["all","console","game","accessory"],le=a=>{var m,d,o,c;return(c=(o=(d=(m=a==null?void 0:a.id)!=null?m:a==null?void 0:a.slug)!=null?d:a==null?void 0:a.productId)!=null?o:a==null?void 0:a.pid)!=null?c:null},ie=a=>{var d,o,c,g,i,u,S,p,n;return{id:le(a),image:Array.isArray(a.mainImage)?a.mainImage[0]:a.mainImage,category:a.category,title:a.productTitle,seller:a.sellerName||"",priceNow:(g=(c=(o=(d=a.salePrice)!=null?d:a.originalPrice)==null?void 0:o.toString)==null?void 0:c.call(o))!=null?g:"",priceOld:a.salePrice!=null?(S=(u=(i=a.originalPrice)==null?void 0:i.toString)==null?void 0:u.call(i))!=null?S:"":void 0,size:"medium",meta:a.productMeta,priceNum:Number((p=a.salePrice)!=null?p:a.originalPrice)||0,sellerScore:Number((n=a.sellerScore)!=null?n:0)}};function he(){const{platform:a,category:m}=O(),d=M(),o=D(),c=decodeURIComponent(a||"");if(!C.includes(c))return s.jsx(X,{to:"/alltype/Switch/all",replace:!0});l.useEffect(()=>{m||d(`/alltype/${c}/all`,{replace:!0,state:{noScroll:!0}})},[m,c,d]);const g=oe.includes(m||"")?m:"all",i=ce[g]||"全部",u=l.useMemo(()=>{const e=q.filter(r=>r.platform===c).map(ie),t=e.filter(r=>!r.id);return t.length&&console.warn("[AlltypePage] 有商品缺少 id：",t),e.filter(r=>!!r.id)},[c]),S=l.useMemo(()=>u.reduce((e,t)=>(e.全部++,A.includes(t.category)&&(e[t.category]=(e[t.category]||0)+1),e),{全部:0,主機:0,遊戲:0,配件:0}),[u]),p=l.useMemo(()=>i==="全部"?u:u.filter(e=>e.category===i),[u,i]),[n,f]=l.useState("default"),b=l.useMemo(()=>{const e=[...p];switch(n){case"price-asc":e.sort((t,r)=>t.priceNum-r.priceNum);break;case"price-desc":e.sort((t,r)=>r.priceNum-t.priceNum);break;case"date-new":e.sort((t,r)=>new Date(r.meta)-new Date(t.meta));break;case"date-old":e.sort((t,r)=>new Date(t.meta)-new Date(r.meta));break;case"score-desc":e.sort((t,r)=>r.sellerScore-t.sellerScore);break;case"score-asc":e.sort((t,r)=>t.sellerScore-r.sellerScore);break}return e},[p,n]),[w,x]=l.useState(1);l.useEffect(()=>{x(1)},[g,c]),l.useEffect(()=>{x(1)},[n]);const P=12,N=Math.ceil(b.length/P),L=l.useMemo(()=>{const e=(w-1)*P,t=e+P;return b.slice(e,t)},[b,w]),T=e=>{x(e)},k=e=>{const t=ne[e]||"all";d(`/alltype/${c}/${t}`,{state:{noScroll:!0}})},_=e=>({pathname:`/alltype/${e}/${g}`,state:{noScroll:!0}}),R=re[c]||[],h=C.filter(e=>e!==c),I=(()=>{var t;const e=((t=document.querySelector(".navbar, .site-header"))==null?void 0:t.offsetHeight)||0;return Math.max(80,e+12)})(),E=e=>{if(!e)return;const t=e.replace(/^#/,"");let r=0;const v=()=>{const B=document.getElementById(t);if(B){const U=B.getBoundingClientRect().top+window.scrollY-I;window.scrollTo({top:U,behavior:"smooth"});return}r<20&&(r+=1,setTimeout(v,60))};setTimeout(v,0)};return l.useEffect(()=>{o.hash&&E(o.hash)},[o.key,o.hash]),s.jsxs(s.Fragment,{children:[s.jsxs($,{children:[s.jsx("title",{children:`遊玩人間市集 ｜ ${y[c]} ｜ ${i}`}),s.jsx("meta",{name:"description",content:"歡迎來到遊玩人間市集，探索各式二手遊戲商品。"})]}),s.jsxs("div",{className:"B_content",children:[s.jsx("div",{className:"B_banner",children:s.jsx(G,{spaceBetween:30,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0,modules:[F,V,Y],className:"mySwiper",children:R.map((e,t)=>s.jsx(H,{children:s.jsx("img",{src:e,alt:"活動橫幅"})},t))})}),s.jsxs("div",{id:"B_itemTitles",className:"B_itemTitles",children:[h[0]&&s.jsx(j,{className:"B_itemTitle",to:_(h[0]),children:y[h[0]]}),s.jsx("p",{className:"B_name",children:y[c]}),h[1]&&s.jsx(j,{className:"B_itemTitle",to:_(h[1]),children:y[h[1]]})]}),s.jsx("div",{className:"B_category",role:"tablist","aria-label":"商品分類 (category 類別)",children:A.map(e=>{var r;const t=i===e;return s.jsxs("button",{className:`B_Categories ${t?"is-active":""}`,type:"button",role:"tab","aria-selected":t,onClick:()=>k(e),children:[e,"（",(r=S[e])!=null?r:0,"）"]},e)})}),s.jsxs("div",{className:"B_sortButtons","aria-label":"排序控制（sorting）",children:[s.jsx("button",{className:n==="price-asc"?"is-active":"",onClick:()=>f(n==="price-asc"?"default":"price-asc"),children:"價格 ↑"}),s.jsx("button",{className:n==="price-desc"?"is-active":"",onClick:()=>f(n==="price-desc"?"default":"price-desc"),children:"價格 ↓"}),s.jsx("button",{className:n==="date-new"?"is-active":"",onClick:()=>f(n==="date-new"?"default":"date-new"),children:"日期 新→舊"}),s.jsx("button",{className:n==="date-old"?"is-active":"",onClick:()=>f(n==="date-old"?"default":"date-old"),children:"日期 舊→新"}),s.jsx("button",{className:n==="score-desc"?"is-active":"",onClick:()=>f(n==="score-desc"?"default":"score-desc"),children:"評分 高→低"}),s.jsx("button",{className:n==="score-asc"?"is-active":"",onClick:()=>f(n==="score-asc"?"default":"score-asc"),children:"評分 低→高"})]}),s.jsx("div",{id:"B_item",className:"B_item",children:L.map(e=>s.jsx(z,{id:e.id,image:e.image,category:e.category,title:e.title,seller:e.seller,priceNow:e.priceNow,priceOld:e.priceOld,size:"medium",linkTo:`/product/${encodeURIComponent(e.id)}`,wrapperClass:"B_cardLink",ariaLabel:e.title},e.id))}),N>1&&s.jsx(K,{totalPages:N,onPageChange:T,currentPage:w})]})]})}export{he as default};
