import{h as O,a as M,u as D,j as r,e as X,r as l,H as $,S as G,A as H,P as F,i as V,k as Y,N as A}from"./react-vendor-B8p8u1OW.js";import{P as q,A as z}from"./index-QZQBwWY5.js";import{P as K}from"./Pagination-BtkJimoQ.js";const W=""+new URL("banner_pokemon-vfmWkoXl.avif",import.meta.url).href,Q=""+new URL("Alltype_banner02-D2iXLrGG.avif",import.meta.url).href,Z=""+new URL("Alltype_banner03-BwrycHns.avif",import.meta.url).href,J=""+new URL("Alltype_PS_banner01-Bc3WwUd5.webp",import.meta.url).href,ee=""+new URL("Alltype_PS_banner02-CxGMZ0Gl.avif",import.meta.url).href,te=""+new URL("Alltype_PS_banner03-B7H7cIoY.avif",import.meta.url).href,ae=""+new URL("Alltype_Xbox_banner01-BHQoPPhq.avif",import.meta.url).href,re=""+new URL("Alltype_Xbox_banner04-DuODmEVd.avif",import.meta.url).href,se={Switch:[W,Q,Z],PS:[J,ee,te],Xbox:[ae,re]},y={Switch:"Switch",PS:"PS系列",Xbox:"Xbox"},j=["全部","主機","遊戲","配件"],ne={全部:"all",主機:"console",遊戲:"game",配件:"accessory"},oe={all:"全部",console:"主機",game:"遊戲",accessory:"配件"},L=["Switch","PS","Xbox"],ce=["all","console","game","accessory"],le=a=>{var m,d,c,n;return(n=(c=(d=(m=a==null?void 0:a.id)!=null?m:a==null?void 0:a.slug)!=null?d:a==null?void 0:a.productId)!=null?c:a==null?void 0:a.pid)!=null?n:null},ie=a=>{var d,c,n,g,i,u,S,h,o;return{id:le(a),image:Array.isArray(a.mainImage)?a.mainImage[0]:a.mainImage,category:a.category,title:a.productTitle,seller:a.sellerName||"",priceNow:(g=(n=(c=(d=a.salePrice)!=null?d:a.originalPrice)==null?void 0:c.toString)==null?void 0:n.call(c))!=null?g:"",priceOld:a.salePrice!=null?(S=(u=(i=a.originalPrice)==null?void 0:i.toString)==null?void 0:u.call(i))!=null?S:"":void 0,size:"medium",meta:a.productMeta,priceNum:Number((h=a.salePrice)!=null?h:a.originalPrice)||0,sellerScore:Number((o=a.sellerScore)!=null?o:0)}};function ge(){const{platform:a,category:m}=O(),d=M(),c=D(),n=decodeURIComponent(a||"");if(!L.includes(n))return r.jsx(X,{to:"/alltype/Switch/all",replace:!0});l.useEffect(()=>{m||d(`/alltype/${n}/all`,{replace:!0,state:{noScroll:!0}})},[m,n,d]);const g=ce.includes(m||"")?m:"all",i=oe[g]||"全部",u=l.useMemo(()=>{const e=q.filter(s=>s.platform===n).map(ie),t=e.filter(s=>!s.id);return t.length&&console.warn("[AlltypePage] 有商品缺少 id：",t),e.filter(s=>!!s.id)},[n]),S=l.useMemo(()=>u.reduce((e,t)=>(e.全部++,j.includes(t.category)&&(e[t.category]=(e[t.category]||0)+1),e),{全部:0,主機:0,遊戲:0,配件:0}),[u]),h=l.useMemo(()=>i==="全部"?u:u.filter(e=>e.category===i),[u,i]),[o,p]=l.useState("default"),w=l.useMemo(()=>{const e=[...h];switch(o){case"price-asc":e.sort((t,s)=>t.priceNum-s.priceNum);break;case"price-desc":e.sort((t,s)=>s.priceNum-t.priceNum);break;case"date-new":e.sort((t,s)=>new Date(s.meta)-new Date(t.meta));break;case"date-old":e.sort((t,s)=>new Date(t.meta)-new Date(s.meta));break;case"score-desc":e.sort((t,s)=>s.sellerScore-t.sellerScore);break;case"score-asc":e.sort((t,s)=>t.sellerScore-s.sellerScore);break}return e},[h,o]),[b,x]=l.useState(1);l.useEffect(()=>{x(1)},[g,n]),l.useEffect(()=>{x(1)},[o]);const P=12,_=Math.ceil(w.length/P),C=l.useMemo(()=>{const e=(b-1)*P,t=e+P;return w.slice(e,t)},[w,b]),T=e=>{x(e)},k=e=>{const t=ne[e]||"all";d(`/alltype/${n}/${t}`,{state:{noScroll:!0}})},N=e=>({pathname:`/alltype/${e}/${g}`,state:{noScroll:!0}}),R=se[n]||[],f=L.filter(e=>e!==n),I=(()=>{var t;const e=((t=document.querySelector(".navbar, .site-header"))==null?void 0:t.offsetHeight)||0;return Math.max(80,e+12)})(),E=e=>{if(!e)return;const t=e.replace(/^#/,"");let s=0;const B=()=>{const v=document.getElementById(t);if(v){const U=v.getBoundingClientRect().top+window.scrollY-I;window.scrollTo({top:U,behavior:"smooth"});return}s<20&&(s+=1,setTimeout(B,60))};setTimeout(B,0)};return l.useEffect(()=>{c.hash&&E(c.hash)},[c.key,c.hash]),r.jsxs(r.Fragment,{children:[r.jsxs($,{children:[r.jsx("title",{children:`遊玩人間市集 ｜ ${y[n]} ｜ ${i}`}),r.jsx("meta",{name:"description",content:"歡迎來到遊玩人間市集，探索各式二手遊戲商品。"})]}),r.jsxs("div",{className:"B_content",children:[r.jsx("div",{className:"B_banner",children:r.jsx(G,{spaceBetween:30,centeredSlides:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0,modules:[H,F,V],className:"mySwiper",children:R.map((e,t)=>r.jsx(Y,{children:r.jsx("img",{src:e,alt:"活動橫幅"})},t))})}),r.jsxs("div",{id:"B_itemTitles",className:"B_itemTitles",children:[f[0]&&r.jsx(A,{className:"B_itemTitle",to:N(f[0]),children:y[f[0]]}),r.jsx("p",{className:"B_name",children:y[n]}),f[1]&&r.jsx(A,{className:"B_itemTitle",to:N(f[1]),children:y[f[1]]})]}),r.jsx("div",{className:"B_category",role:"tablist","aria-label":"商品分類 (category 類別)",children:j.map(e=>{var s;const t=i===e;return r.jsxs("button",{className:`B_Categories ${t?"is-active":""}`,type:"button",role:"tab","aria-selected":t,onClick:()=>k(e),children:[e,"（",(s=S[e])!=null?s:0,"）"]},e)})}),r.jsxs("div",{className:"B_sortButtons","aria-label":"排序控制（sorting）",children:[r.jsx("button",{className:o==="price-asc"?"is-active":"",onClick:()=>p(o==="price-asc"?"default":"price-asc"),children:"價格 ↑"}),r.jsx("button",{className:o==="price-desc"?"is-active":"",onClick:()=>p(o==="price-desc"?"default":"price-desc"),children:"價格 ↓"}),r.jsx("button",{className:o==="date-new"?"is-active":"",onClick:()=>p(o==="date-new"?"default":"date-new"),children:"日期 新→舊"}),r.jsx("button",{className:o==="date-old"?"is-active":"",onClick:()=>p(o==="date-old"?"default":"date-old"),children:"日期 舊→新"})]}),r.jsx("div",{id:"B_item",className:"B_item",children:C.map(e=>r.jsx(z,{id:e.id,image:e.image,category:e.category,title:e.title,seller:e.seller,priceNow:e.priceNow,priceOld:e.priceOld,size:"medium",linkTo:`/product/${encodeURIComponent(e.id)}`,wrapperClass:"B_cardLink",ariaLabel:e.title},e.id))}),_>1&&r.jsx(K,{totalPages:_,onPageChange:T,currentPage:b})]})]})}export{ge as default};
