import{r as p,j as s,S as $,h as q,L as y,g as P,u as w}from"./react-vendor-CToDt6bN.js";import{P as k}from"./swiper-N-f5SBSU.js";import{g as A,f as D,D as B,G as L,d as R,h as F,p as M,i as E,S as O,W as U,j as X}from"./index-BlECyqGo.js";import{s as I,q as G,f as z,c as W}from"./Star-C42fQbba.js";import{a as T,b as H,g as J}from"./cart-BFkCGOgZ.js";import"./vendor-DLEfv8Se.js";const K=({mainImage:n=[],productTitle:t="",productMeta:e="",originalPrice:d,salePrice:o,productStatus:x,st:r={},onAddToCart:N=()=>{},onBuyNow:b=()=>{}})=>{var f;const j=(n||[]).slice(0,4).map((_,h)=>({src:_,alt:`商品大圖 ${h+1}`})),[i,a]=p.useState(0),[m,c]=p.useState(!1);let v=null,l=r.status||"商品狀態";if(typeof x=="string"){const _=(f=A)==null?void 0:f[x];v=(_==null?void 0:_.image)||null,l=(_==null?void 0:_.label)||l}else x&&typeof x=="object"&&(v=x.icon||null,l=x.label||l);const g=s.jsx("div",{className:"product-price",children:o!=null?s.jsxs(s.Fragment,{children:[s.jsxs("span",{className:"original-price",children:["NTD$",Number(d).toLocaleString()]}),s.jsxs("span",{className:"sale-price",children:["NTD$",Number(o).toLocaleString()]})]}):s.jsxs("span",{className:"sale-price",children:["NTD$",Number(d).toLocaleString()]})});return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"product-page product-page-pc",children:[s.jsxs("div",{className:"product-gallery",children:[s.jsx("div",{className:"thumbnails",children:j.map((_,h)=>s.jsx("div",{className:`thumb ${h===i?"is-active":""}`,onMouseEnter:()=>a(h),children:s.jsx("img",{src:_.src,alt:`縮圖 ${h+1}`})},h))}),s.jsx("div",{className:"main-image",children:j[i]&&s.jsx("img",{src:j[i].src,alt:j[i].alt})})]}),s.jsxs("div",{className:"product-detail",children:[s.jsxs("div",{className:"product-main",children:[s.jsx("h1",{className:"product-title",children:t}),s.jsxs("div",{className:"product-mainInfo",children:[s.jsxs("p",{className:"product-meta",children:["上架日期：",(e||"").replaceAll("-",".")]}),g]})]}),s.jsxs("div",{className:"product-actions",children:[s.jsx("button",{type:"button",className:`btn-fav ${m?"active":""}`,onClick:()=>c(!m),"aria-label":"加入收藏（Add to favorites 加入收藏）",children:s.jsx("span",{className:"heart"})}),s.jsx("button",{type:"button",className:"btn-cart btn",onClick:N,"aria-label":"加入購物車（Add to Cart 加入購物車）",children:"加入購物車"}),s.jsx("button",{type:"button",className:"btn-buy btn",onClick:b,"aria-label":"直接購買（Buy Now 直接購買）",children:"直接購買"})]}),v&&s.jsx("div",{className:"product-status",children:s.jsx("img",{src:v,alt:l})}),s.jsxs("div",{className:"product-description",children:[s.jsx("h2",{children:"商品說明"}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品狀態："}),r.status||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"其他備註："}),r.note||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品位置："}),r.location||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"運送服務："}),r.shipping||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"付款方式："}),r.payment||"-"]})]})]})]})]}),s.jsxs("div",{className:"product-page product-page-mobile",children:[s.jsx("div",{className:"carousel",children:s.jsx($,{modules:[k],pagination:{type:"fraction"},style:{width:"100%",height:"100%"},children:j.map((_,h)=>s.jsx(q,{children:s.jsx("img",{src:_.src,alt:_.alt,style:{width:"100%",height:"100%",objectFit:"cover"}})},h))})}),s.jsxs("div",{className:"detail_mobile",children:[s.jsx("div",{className:"mobile_title",children:t}),s.jsxs("div",{className:"mobile_infor",children:[s.jsxs("div",{className:"mobile_price",children:[s.jsx("p",{className:"new_price",children:o!=null?`NTD$${Number(o).toLocaleString()}`:`NTD$${Number(d).toLocaleString()}`}),o!=null&&s.jsxs("p",{className:"old_price",children:["NTD$",Number(d).toLocaleString()]})]}),s.jsxs("div",{className:"mobile_date",children:["上架日期：",(e||"").replaceAll("-",".")]})]}),s.jsxs("div",{className:"mobile_description",children:[s.jsxs("div",{className:"md",children:[s.jsx("h2",{children:"商品說明"}),v&&s.jsx("img",{src:v,alt:l,className:"mobile_status"})]}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品狀態："}),r.status||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"其他備註："}),r.note||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"商品位置："}),r.location||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"運送服務："}),r.shipping||"-"]}),s.jsxs("li",{children:[s.jsx("p",{className:"st",children:"付款方式："}),r.payment||"-"]})]})]}),s.jsxs("div",{className:"mobile_actions",style:{display:"flex",gap:8,marginTop:12},children:[s.jsx("button",{type:"button",className:"btn-cart btn",onClick:N,"aria-label":"加入購物車（Add to Cart 加入購物車）",style:{flex:1},children:"加入購物車"}),s.jsx("button",{type:"button",className:"btn-buy btn",onClick:b,"aria-label":"直接購買（Buy Now 直接購買）",style:{flex:1},children:"直接購買"})]})]})]})]})},S={check:W,fastShip:z,quickReply:G},Q=({sellerAvatar:n,sellerName:t,sellerScore:e,sellerCount:d,sellerLocation:o,sellerTags:x=[],sellerDesc:r})=>{var b,j,i,a;const N=n||D;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"seller seller-pc",children:[s.jsxs("div",{className:"seller__profile",children:[s.jsx("img",{src:N,alt:"賣家頭像",className:"seller__avatar"}),s.jsx("p",{className:"seller__name",children:t})]}),s.jsxs("div",{className:"seller__rwd",children:[s.jsxs("div",{className:"seller__stats",children:[s.jsxs("div",{className:"seller__rating",children:[s.jsx("span",{className:"seller__score",children:(j=(b=e==null?void 0:e.toFixed)==null?void 0:b.call(e,1))!=null?j:e}),s.jsx("img",{src:I,alt:"評分星等"}),s.jsxs("span",{className:"seller__count",children:["(",d,"則評價)"]})]}),s.jsx("p",{className:"seller__location",children:o}),s.jsx("div",{className:"seller__tags",children:x.map(m=>{const c=S[m];return c?s.jsx("img",{src:c,alt:m},m):null})})]}),s.jsx("div",{className:"seller__desc",children:s.jsx("p",{children:r})})]}),s.jsxs("div",{className:"seller__actions",children:[s.jsx("button",{className:"btn",children:"追蹤+"}),s.jsx("button",{className:"btn",children:"聊聊"})]})]}),s.jsxs("div",{className:"seller seller-mobile",children:[s.jsx("img",{src:N,alt:"賣家頭像",className:"seller__avatar"}),s.jsxs("div",{className:"scenter",children:[s.jsx("p",{className:"seller__name",children:t}),s.jsxs("div",{className:"seller__rating",children:[s.jsx("span",{className:"seller__score",children:(a=(i=e==null?void 0:e.toFixed)==null?void 0:i.call(e,1))!=null?a:e}),s.jsx("img",{src:I,alt:"評分星等"}),s.jsxs("span",{className:"seller__count",children:["(",d,"則評價)"]})]}),s.jsx("div",{className:"seller__tags",children:x.map(m=>{const c=S[m];return c?s.jsx("img",{src:c,alt:m},m):null})})]}),s.jsxs("div",{className:"seller__actions",children:[s.jsx("button",{className:"btn",children:"追蹤+"}),s.jsx("button",{className:"btn",children:"聊聊"})]})]})]})},Y=({detailContent:n=""})=>s.jsxs("div",{className:"detail",children:[s.jsx("div",{className:"detail_title",children:"商品詳細說明"}),s.jsx("div",{className:"detail_content",children:n||"—"})]}),u=(n,t)=>Math.floor(Math.random()*(t-n+1))+n,V=()=>{const n="23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz";return n[u(0,n.length-1)]},C=(n=5)=>Array.from({length:n},V).join("");function Z({length:n=5,width:t=120,height:e=40,onChange:d}){const o=p.useRef(null),[x,r]=p.useState(C(n)),N=p.useCallback(j=>{const i=o.current;if(!i)return;const a=i.getContext("2d");a.clearRect(0,0,t,e),a.fillStyle="#f3f4f6",a.fillRect(0,0,t,e);for(let c=0;c<30;c++)a.fillStyle=`rgba(${u(0,255)}, ${u(0,255)}, ${u(0,255)}, 0.6)`,a.fillRect(u(0,t),u(0,e),1,1);for(let c=0;c<3;c++)a.strokeStyle=`rgba(${u(0,255)}, ${u(0,255)}, ${u(0,255)}, 0.7)`,a.lineWidth=u(1,2),a.beginPath(),a.moveTo(u(0,t/3),u(0,e)),a.bezierCurveTo(u(0,t),u(0,e),u(0,t),u(0,e),u(t/2,t),u(0,e)),a.stroke();const m=t/(j.length+1);for(let c=0;c<j.length;c++){const v=j[c],l=u(18,24);a.font=`${l}px ui-monospace, SFMono-Regular, Menlo, monospace`,a.fillStyle=`rgb(${u(30,120)}, ${u(30,120)}, ${u(30,120)})`;const g=m*(c+1),f=u(e*.6,e*.8),_=u(-25,25)*Math.PI/180;a.save(),a.translate(g,f),a.rotate(_),a.fillText(v,0,0),a.restore()}},[t,e]),b=p.useCallback(()=>{const j=C(n);r(j),d==null||d(j)},[n,d]);return p.useEffect(()=>{N(x)},[x,N]),p.useEffect(()=>{d==null||d(x)},[]),s.jsxs("div",{className:"captcha",children:[s.jsx("canvas",{ref:o,width:t,height:e,"aria-label":"驗證碼（captcha，驗證使用者是否為人類）圖片",role:"img"}),s.jsx("button",{type:"button",className:"captcha__refresh",onClick:b,"aria-label":"重整驗證碼",children:"↻"})]})}const ss=({productId:n,initialQa:t=[]})=>{const[e,d]=p.useState(""),[o,x]=p.useState(""),[r,N]=p.useState(""),[b,j]=p.useState(""),i=p.useMemo(()=>`qa:${n||"default"}`,[n]),[a,m]=p.useState(()=>{try{const l=localStorage.getItem(i);return l?JSON.parse(l):t}catch(l){return t}});p.useEffect(()=>{try{localStorage.setItem(i,JSON.stringify(a))}catch(l){}},[a,i]);const c=()=>{const l=new Date,g=f=>String(f).padStart(2,"0");return`${l.getFullYear()}.${g(l.getMonth()+1)}.${g(l.getDate())} ${g(l.getHours())}:${g(l.getMinutes())}:${g(l.getSeconds())}`},v=l=>{if(l.preventDefault(),!b.trim()){N("請先輸入提問內容 ❌");return}if(o.trim().toLowerCase()!==e.trim().toLowerCase()){N("驗證失敗，請再試一次 ❌");return}const g={user:"@guest****",time:c(),content:b.trim()};m(f=>[g,...f]),j(""),x(""),N("驗證成功 ✅ 已送出提問")};return s.jsxs("div",{className:"qa",children:[a.length>0?a.map((l,g)=>s.jsxs("div",{className:"qa_item",children:[s.jsxs("div",{className:"qa_header",children:[s.jsxs("p",{className:"qa_number",children:["問題",a.length-g]}),s.jsx("p",{className:"qa_user",children:l.user}),s.jsxs("p",{className:"qa_time",children:["(",l.time,")"]})]}),s.jsx("div",{className:"qa_question",children:s.jsx("p",{children:l.content})}),l.answer&&s.jsxs("div",{className:"qa_answer",children:[s.jsxs("div",{className:"qa_ans",children:[s.jsx("span",{className:"qa_answer-label",children:"答覆："}),s.jsx("p",{className:"qa_answer-content",children:l.answer})]}),s.jsxs("p",{className:"qa_time",children:["(",l.answerTime,")"]})]})]},g)):s.jsx("p",{className:"qa_empty",children:"目前還沒有提問，成為第一個提問的人吧！"}),s.jsxs("form",{className:"qa_ask",onSubmit:v,children:[s.jsx("p",{className:"qa_title",children:"提出問題"}),s.jsx("span",{className:"qa_policy",children:"為保障會員交易安全，留言請勿填寫個人資料、外部連結或任何導私下交易之內容，否則您送出的內容可能無法正常顯示。"}),s.jsx("textarea",{name:"askbox",className:"qa_askbox",placeholder:"(250個中文字以內)",maxLength:250,value:b,onChange:l=>j(l.target.value),required:!0}),s.jsxs("div",{className:"allCaptcha",children:[s.jsxs("div",{className:"qa__field qa__captcha",children:[s.jsx(Z,{length:5,onChange:d}),s.jsx("input",{type:"text",id:"captcha",name:"captcha",className:"qa__captcha-input",inputMode:"text",autoComplete:"off",placeholder:"請輸入上方驗證碼",value:o,onChange:l=>x(l.target.value),required:!0}),r&&s.jsx("small",{className:`qa_msg ${r.includes("成功")?"ok":"err"}`,children:r})]}),s.jsx("button",{className:"qa_btn btn",type:"submit",children:"送出"})]})]})]})},es=({userImg:n,userName:t,upDate:e,commodityImage:d,commodityTitle:o,commodityPrice:x})=>{const[r,N]=p.useState(!1);return s.jsx("div",{className:"abc",children:s.jsx("div",{className:"o1",children:s.jsxs("div",{className:"o2",children:[s.jsxs("div",{className:"cain",children:[s.jsxs(y,{to:"/Reviewpage",className:"userInfo",children:[s.jsx("div",{children:s.jsx("img",{src:n,alt:"",className:"userImg"})}),s.jsxs("div",{children:[s.jsx("p",{className:"userName",children:t}),s.jsx("p",{className:"upDate",children:e})]})]}),s.jsxs("a",{href:"",className:"commodityInfo",children:[s.jsx("div",{className:"comImg",children:s.jsx("img",{src:d,alt:""})}),s.jsx("p",{className:"comTitle",children:o}),s.jsxs("p",{className:"comPrice",children:["NT$",x]})]})]}),s.jsx("div",{className:"comHeart",children:s.jsx("button",{className:`btn-fav ${r?"active":""}`,onClick:()=>N(!r),children:s.jsx("span",{className:"heart"})})})]})})})},as=()=>{const n=[{id:1,userImg:L,userName:"paly**56",upDate:"3天前",commodityImage:B,commodityTitle:"咚奇剛蕉力全開+咚奇剛amiibo",commodityPrice:"800"},{id:2,userImg:F,userName:"Ds2CE**6",upDate:"3天前",commodityImage:R,commodityTitle:"死亡擱淺典藏版",commodityPrice:"1100"},{id:3,userImg:E,userName:"Ssp**5",upDate:"3天前",commodityImage:M,commodityTitle:"PS5 PRO主機 1TB 極致黑",commodityPrice:"9999"},{id:4,userImg:U,userName:"fun31**56",upDate:"3天前",commodityImage:O,commodityTitle:"Switch 2全新主機",commodityPrice:"5000"}];return s.jsx("div",{className:"containerPrCard",children:n.map(t=>s.jsx(es,{userImg:t.userImg,userName:t.userName,upDate:t.upDate,commodityImage:t.commodityImage,commodityTitle:t.commodityTitle,commodityPrice:t.commodityPrice},t.id))})},ts=()=>s.jsxs("div",{className:"recommend",children:[s.jsx("p",{className:"recommend_title",children:"你可能有興趣的商品"}),s.jsx(as,{}),s.jsx("div",{className:"recommend_btn",children:s.jsx("button",{className:"btn",children:"更多商品"})})]}),ls=({title:n="",img:t="",qty:e=1,count:d=0,visible:o=!1,onClick:x=()=>{},onClose:r=()=>{},duration:N=3e3})=>{const b=p.useRef(null);return p.useEffect(()=>{if(o)return clearTimeout(b.current),b.current=setTimeout(()=>r(),N),()=>clearTimeout(b.current)},[o,N,r]),s.jsx("div",{className:`cartToast ${o?"is-show":""}`,role:"status","aria-live":"polite","aria-atomic":"true",children:s.jsxs("button",{type:"button",className:"cartToast__card",onClick:x,children:[s.jsx("div",{className:"cartToast__media",children:t?s.jsx("img",{src:t,alt:""}):s.jsx("div",{className:"ph"})}),s.jsxs("div",{className:"cartToast__content",children:[s.jsx("p",{className:"cartToast__title",children:n}),s.jsxs("p",{className:"cartToast__desc",children:["已加入購物車 ×",e," ｜ 目前共 ",d," 件"]}),s.jsx("p",{className:"cartToast__cta",children:"前往購物車 →"})]}),s.jsx("span",{className:"cartToast__close","aria-label":"關閉（Close 關閉）",onClick:j=>{j.stopPropagation(),r()},children:"×"})]})})},cs={Switch:{label:"Switch",to:"/alltype/Switch/all#B_itemTitles"},PS:{label:"PS",to:"/alltype/PS/all#B_itemTitles"},Xbox:{label:"Xbox",to:"/alltype/Xbox/all#B_itemTitles"}},us=()=>{var j;const{id:n}=P(),t=decodeURIComponent(n||""),e=X(t),d=w();p.useEffect(()=>{document.title=e!=null&&e.productTitle?`${e.productTitle} ｜ 遊玩人間市集`:"商品不存在 ｜ 遊玩人間市集"},[e==null?void 0:e.productTitle]);const[o,x]=p.useState({show:!1,title:"",img:"",qty:1,count:0});if(!e)return s.jsxs("div",{className:"product",children:[s.jsxs("nav",{className:"breadcrumb",children:[s.jsx(y,{to:"/",children:"首頁"}),s.jsx("span",{className:"angleBracket",children:"›"}),s.jsx("span",{className:"is-current",children:"找不到此商品"})]}),s.jsx("div",{className:"section",children:"很抱歉，這個商品不存在或已下架。"})]});let r;if(Array.isArray(e.breadcrumb)&&e.breadcrumb.length>0)r=e.breadcrumb;else{const i=_=>{const h=String(_||"").trim();return h==="PS系列"||h==="PlayStation"||h==="ps"||h==="Ps"?"PS":h==="XBOX"||h==="xbox"?"Xbox":h||"Switch"},a=_=>{const h=String(_||"").replace(/\u3000/g," ").trim();return["主機","機台"].includes(h)?"主機":["遊戲","軟體","遊戲片"].includes(h)?"遊戲":["配件","周邊","周邊商品"].includes(h)?"配件":h===""||h==="全部"?"全部":h},m=i(e.platform),c=a(e.category),l={主機:"console",遊戲:"game",配件:"accessory",全部:"all"}[c]||"all",g=(j=cs[m])!=null?j:{label:m||"Switch",to:`/alltype/${encodeURIComponent(m||"Switch")}/all#B_itemTitles`},f={label:c||"全部",to:`/alltype/${encodeURIComponent(m)}/${l}#B_item`};r=[g,f]}const N=(i=1)=>{var a,m;try{const c=Array.isArray(e.mainImage)?e.mainImage[0]:e.thumb||"";T({id:e.id,title:e.productTitle,price:(m=(a=e.salePrice)!=null?a:e.originalPrice)!=null?m:0,img:c},Number(i)||1);const v=H();x({show:!0,title:e.productTitle,img:c,qty:Number(i)||1,count:v})}catch(c){console.error("Add to cart failed（加入購物車失敗）:",c,{addItemType:typeof T,getCartType:typeof J}),alert("加入購物車失敗，請稍後再試。")}},b=(i=1)=>{var a,m;try{const c=Array.isArray(e.mainImage)?e.mainImage[0]:e.thumb||"";T({id:e.id,title:e.productTitle,price:(m=(a=e.salePrice)!=null?a:e.originalPrice)!=null?m:0,img:c},Number(i)||1),d("/Shopping_cart")}catch(c){console.error("Buy now failed（立即購買失敗）:",c),alert("處理失敗，請稍後再試。")}};return s.jsxs(s.Fragment,{children:[s.jsx(ls,{title:o.title,img:o.img,qty:o.qty,count:o.count,visible:o.show,onClick:()=>d("/Shopping_cart"),onClose:()=>x(i=>({...i,show:!1})),duration:3e3}),s.jsxs("div",{className:"product",children:[s.jsxs("nav",{className:"breadcrumb","aria-label":"Breadcrumb（導覽路徑）",children:[s.jsx(y,{to:"/",children:"首頁"}),s.jsx("span",{className:"angleBracket",children:"›"}),r.map((i,a)=>s.jsxs("span",{className:"breadcrumb__item",children:[i.to?s.jsx(y,{to:i.to,children:i.label}):s.jsx("span",{children:i.label}),s.jsx("span",{className:"angleBracket",children:"›"})]},`${i.label}-${a}`)),s.jsx("span",{className:"is-current",children:e.productTitle})]}),s.jsx("section",{className:"product__info section",children:s.jsx(K,{...e,onAddToCart:N,onBuyNow:b})}),s.jsxs("aside",{className:"product__seller section",children:[s.jsx("div",{className:"top_decorate"}),s.jsx(Q,{sellerAvatar:e.sellerAvatar,sellerName:e.sellerName,sellerScore:e.sellerScore,sellerCount:e.sellerCount,sellerLocation:e.sellerLocation,sellerTags:e.sellerTags,sellerDesc:e.sellerDesc}),s.jsx("div",{className:"down_decorate"})]}),s.jsx("section",{className:"product__detail section",children:s.jsx(Y,{detailContent:e.detailContent})}),s.jsxs("section",{className:"product__qa section",children:[s.jsx("div",{className:"top_decorate2"}),s.jsx(ss,{productId:e.id,initialQa:e.qa||[]}),s.jsx("div",{className:"down_decorate2"})]}),s.jsx("section",{className:"product__recommend section",children:s.jsx(ts,{items:e.recommendItems||[]})})]})]})};export{us as default};
